function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:MOUNTAIN_VIEW_LAT,lng:MOUNTAIN_VIEW_LON},zoom:DEFAULT_ZOOM_SIZE,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.BOTTOM_RIGHT}}),document.getElementById("map").style.bottom=0;new google.maps.places.Autocomplete(document.getElementById("near"));largeInfowindow=largeInfowindow||new google.maps.InfoWindow,noodleHouseMapFactory()}function noodleHouseMapFactory(){return noodleHouseMap||(noodleHouseMap=new NoodleHouseMap),noodleHouseMap}function createMarker(o){var e=makeMarkerIcon(DEFALT_ICON_COLOR),n=makeMarkerIcon(HIGH_LIGHTED_ICON_COLOR),t=new google.maps.Marker({map:map,position:{lat:o.location.lat,lng:o.location.lng},title:o.name,icon:e,animation:google.maps.Animation.DROP,id:o.id});return t.addListener("click",function(){selectMarkerAction(t,o)}),t.addListener("mouseover",function(){this.setIcon(n)}),t.addListener("mouseout",function(){null==t.getAnimation()&&this.setIcon(e)}),t}function selectMarkerAction(o,e){var n=makeMarkerIcon(DEFALT_ICON_COLOR),t=makeMarkerIcon(HIGH_LIGHTED_ICON_COLOR);null!==o.getAnimation()?o.setAnimation(null):(markers.forEach(function(e){e.setAnimation(null),e!=o&&e.setIcon(n)}),o.setAnimation(google.maps.Animation.BOUNCE),o.setIcon(t),setValuesForInfowindowTemplate(e),populateInfoWindow(o,largeInfowindow))}function zoom(o){var e="";o.location.city&&o.location.address?e=o.location.city+" "+o.location.address:o.location.city&&(e=o.location.city),""!==e&&(new google.maps.Geocoder).geocode({address:o.location.address},function(o,e){e===google.maps.GeocoderStatus.OK&&(map.setCenter(o[0].geometry.location),map.setZoom(15))})}function setValuesForInfowindowTemplate(o){infowindowPhotoLink=o.photoLink,infowindowAddressInfo=(o.location.city||"")+" "+(o.location.address||""),infowindowCheckinCount=o.stats.checkinsCount||0,infowindowUsersCount=o.stats.usersCount||0,infowindowRepeatRate=o.repeatRate||0,infowindowPhone=o.contact.phone||"",infowindowFormattedPhone=o.contact.formattedPhone||"",infowindowUrl=o.url||"",o.hours&&o.hours.status?(infowindowHourStatus=o.hours.status,infowindowIsOpen=o.hours.isOpen):o.hours&&null!=o.isOpen?(infowindowHourStatus="",infowindowIsOpen=o.hours.isOpen):(infowindowHourStatus="",infowindowIsOpen=!1),o.rating&&(infowindowRate1=o.rating>=2,infowindowRate2=o.rating>=4,infowindowRate3=o.rating>=6,infowindowRate4=o.rating>=8,infowindowRate5=10==o.rating)}function makeMarkerIcon(o){return new google.maps.MarkerImage("http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|"+o+"|40|_|%E2%80%A2",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(21,34))}function populateInfoWindow(o,e){if(e.marker!=o){e.setContent(""),e.marker=o,google.maps.event.clearListeners(e,"closeclick"),e.addListener("closeclick",function(){e.marker&&null!==e.marker.getAnimation()&&e.marker.setAnimation(null),e.marker=null});(new google.maps.StreetViewService).getPanoramaByLocation(e.marker.position,50,function(n,t){var a;if(t==google.maps.StreetViewStatus.OK){var i=n.location.latLng,r=google.maps.geometry.spherical.computeHeading(i,o.position);a=noodleHouseMap.infowindowTemplate(getParamsForTemplate(o,!0)),e.setContent(a);var s={position:i,pov:{heading:r,pitch:30,zoom:1}};new google.maps.StreetViewPanorama(document.getElementById("pano"),s)}else a=noodleHouseMap.infowindowTemplate(getParamsForTemplate(o,!1)),e.setContent(a)}),e.open(map,e.marker)}else e&&e.open(map,e.marker)}function getParamsForTemplate(o,e){return{title:o.title,markerId:o.id,photoLink:infowindowPhotoLink,addressInfo:infowindowAddressInfo,hasStreetView:e,checkinsCount:infowindowCheckinCount,usersCount:infowindowUsersCount,repeatRate:infowindowRepeatRate,phone:infowindowPhone,formattedPhone:infowindowFormattedPhone,url:infowindowUrl,hourStatus:infowindowHourStatus,rate1:infowindowRate1,rate2:infowindowRate2,rate3:infowindowRate3,rate4:infowindowRate4,rate5:infowindowRate5,isOpen:infowindowIsOpen}}var map,noodleHouseMap,largeInfowindow,markers=[],infowindowPhotoLink="",infowindowAddressInfo="",infowindowCheckinCount=0,infowindowUsersCount=0,infowindowRepeatRate=0,infowindowPhone="",infowindowFormattedPhone="",infowindowUrl="",infowindowHourStatus="",infowindowIsOpen=!1,infowindowRate1=!1,infowindowRate2=!1,infowindowRate3=!1,infowindowRate4=!1,infowindowRate5=!1,NoodleHouseMap=function(){this.loading=!0,this.lat=MOUNTAIN_VIEW_LAT,this.lng=MOUNTAIN_VIEW_LON,this.foursquare=foursquareFactory(this.lat,this.lng),this.infowindowTemplate=Handlebars.compile(document.getElementById("infowindow-template").innerHTML)};NoodleHouseMap.prototype.getLocation=function(o,e){navigator.geolocation?navigator.geolocation.getCurrentPosition(o,e):(console.log("Geolocation is not available..."),e())},NoodleHouseMap.prototype.changeNear=function(o,e,n){(new google.maps.Geocoder).geocode({address:o},function(o,t){if(t==google.maps.GeocoderStatus.OK){var a=o[0].geometry.location;noodleHouseMap.lat=a.lat(),noodleHouseMap.lng=a.lng(),map.setCenter(a),noodleHouseMap.foursquare.updateLocation(noodleHouseMap.lat,noodleHouseMap.lng),noodleHouseMap.foursquare.search(e,n)}else n("Search location error","Input location was not founded.")})},NoodleHouseMap.prototype.moveToLocation=function(o,e){var n={lat:o,lng:e};map&&!noodleHouseMap.map?(noodleHouseMap.map=map,map.setCenter(new google.maps.LatLng(n))):noodleHouseMap.map=new google.maps.Map(document.getElementById("map"),{center:n,zoom:DEFAULT_ZOOM_SIZE,styles:MAP_STYLES,mapTypeControl:!1}),largeInfowindow=largeInfowindow||new google.maps.InfoWindow},NoodleHouseMap.prototype.loadDefaultNoodleHouses=function(o,e){var n=this;this.getLocation(function(t){n.lat=t.coords.latitude,n.lng=t.coords.longitude,n.foursquare.updateLocation(n.lat,n.lng),noodleHouseMap.moveToLocation(n.lat,n.lng),noodleHouseMap.foursquare.search(o,e)},function(){noodleHouseMap.foursquare.search(o,e)})},NoodleHouseMap.prototype.setMarkers=function(o){o.forEach(function(o){markers.push(createMarker(o))}),this.showListings()},NoodleHouseMap.prototype.showAllMarkers=function(){markers.forEach(function(o){o.setVisible(!0)})},NoodleHouseMap.prototype.showFilteredMarkers=function(o){markers.push(createMarker(o)),this.showListings();var e=markers.filter(function(e){return e.id===o.id});e[0].length>0&&e.setVisible(!0)},NoodleHouseMap.prototype.removeMarkers=function(){markers.forEach(function(o){o.setMap(null)}),markers=[]},NoodleHouseMap.prototype.hideMarkers=function(){markers.forEach(function(o){o.setVisible(!1)})},NoodleHouseMap.prototype.showListings=function(){var o=new google.maps.LatLngBounds,e=this;e.map||(e.map=map),markers.forEach(function(n){n.setMap(e.map),o.extend(n.position)}),noodleHouseMap.map.fitBounds(o)},NoodleHouseMap.prototype.showSelectedNoodleHouse=function(o){var e=markers.filter(function(e){return e.id===o.id});e[0]&&selectMarkerAction(e[0],o)};